<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeConnect - Developer Platform</title>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap");

      * {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif,
          sans-serif;
      }

      html,
      body {
        height: auto;
        overflow-x: hidden;
        overflow-y: auto;
      }

      .hero-gradient {
        background: linear-gradient(
          135deg,
          #0f0f23 1%,
          #1e1b4b 25%,
          #312e81 50%,
          #4c1d95 75%,
          #7c3aed 100%
        );
        position: relative;
        min-height: 100vh;
      }

      .hero-gradient::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
          circle at 50% 50%,
          rgba(139, 92, 246, 0.1) 0%,
          transparent 50%
        );
      }

      .hero-gradient::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 0%,
          rgba(139, 92, 246, 0.05) 50%,
          transparent 100%
        );
      }

      .glass-card {
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.26);
      }

      .glass-nav {
        backdrop-filter: blur(20px);
        background: rgba(15, 15, 35, 0.8);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .btn-bold {
        background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
        box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.4);
        transform: translateY(0);
        transition: all 0.3s ease;
      }

      .btn-bold:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #9333ea 100%);
        box-shadow: 0 20px 35px -5px rgba(139, 92, 246, 0.6);
        transform: translateY(-2px);
      }

      .btn-outline {
        background: transparent;
        border: 2px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }

      .btn-outline:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 10px 25px -5px rgba(255, 255, 255, 0.1);
      }

      .text-gradient {
        background: linear-gradient(135deg, #ffffff 0%, #e5e7eb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .text-accent {
        background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .floating-animation {
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        33% {
          transform: translateY(-20px) rotate(1deg);
        }
        66% {
          transform: translateY(-10px) rotate(-1deg);
        }
      }

      .glow-effect {
        box-shadow: 0 0 50px rgba(139, 92, 246, 0.3);
      }

      .tech-badge {
        background: linear-gradient(
          135deg,
          rgba(139, 92, 246, 0.2) 0%,
          rgba(168, 85, 247, 0.2) 100%
        );
        border: 1px solid rgba(139, 92, 246, 0.3);
        backdrop-filter: blur(10px);
      }

      /* Ensure all interactive elements are above background */
      button,
      input,
      textarea,
      select,
      .glass-card,
      .glass-nav {
        position: relative;
        z-index: 10;
      }

      /* Make sure pointer events work */
      .pointer-events-none {
        pointer-events: none;
      }
    </style>
  </head>
  <body class="hero-gradient">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const API_BASE = "http://localhost:5001/api";

      const api = {
        async login(username, password) {
          const response = await fetch(`${API_BASE}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });
          return response.json();
        },
        async register(username, password) {
          const response = await fetch(`${API_BASE}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });
          return response.json();
        },
        async getUserProjects() {
          const token = localStorage.getItem("token");
          const response = await fetch(`${API_BASE}/projects/my`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          return response.json();
        },
        async uploadProject(formData) {
          const token = localStorage.getItem("token");
          const response = await fetch(`${API_BASE}/projects/upload`, {
            method: "POST",
            headers: { Authorization: `Bearer ${token}` },
            body: formData,
          });
          return response.json();
        },
        async deleteProject(projectId) {
          const token = localStorage.getItem("token");
          const response = await fetch(`${API_BASE}/projects/${projectId}`, {
            method: "DELETE",
            headers: { Authorization: `Bearer ${token}` },
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(
              data.message || `HTTP error! status: ${response.status}`
            );
          }

          return data;
        },
        async downloadFile(projectId, filename) {
          const token = localStorage.getItem("token");
          const response = await fetch(
            `${API_BASE}/projects/${projectId}/files/${filename}`,
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
          }
        },
      };

      function LoginForm({ onLogin, isLogin, toggleMode }) {
        const [loading, setLoading] = useState(false);
        const usernameRef = useRef();
        const passwordRef = useRef();

        const handleSubmit = async (e) => {
          e.preventDefault();
          setLoading(true);
          const username = usernameRef.current.value;
          const password = passwordRef.current.value;

          try {
            const response = isLogin
              ? await api.login(username, password)
              : await api.register(username, password);

            if (response.success || response.token) {
              localStorage.setItem("token", response.token);
              localStorage.setItem("user", JSON.stringify(response.user));
              onLogin(response.user);
            } else {
              alert(response.message || "Authentication failed");
            }
          } catch (error) {
            alert("Authentication failed. Please try again.");
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="min-h-screen flex items-center justify-center p-4 relative">
            {/* Floating elements for visual appeal */}
            <div className="absolute top-20 left-10 w-20 h-20 bg-purple-500 rounded-full opacity-10 floating-animation pointer-events-none"></div>
            <div
              className="absolute top-40 right-20 w-16 h-16 bg-blue-400 rounded-full opacity-10 floating-animation pointer-events-none"
              style={{ animationDelay: "2s" }}
            ></div>
            <div
              className="absolute bottom-32 left-20 w-24 h-24 bg-pink-400 rounded-full opacity-10 floating-animation pointer-events-none"
              style={{ animationDelay: "4s" }}
            ></div>

            <div className="glass-card rounded-3xl p-10 w-full max-w-md relative z-50">
              <div className="text-center mb-10">
                <div className="w-24 h-24 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-6 glow-effect">
                  <i className="fas fa-code text-4xl text-white"></i>
                </div>
                <h1 className="text-4xl font-black text-gradient mb-3">
                  CodeConnect
                </h1>
                <h2 className="text-xl font-bold text-accent mb-2">
                  {isLogin ? "Welcome Back!" : "Join the Revolution"}
                </h2>
                <p className="text-white text-opacity-70 font-medium">
                  {isLogin
                    ? "Continue your coding journey"
                    : "Where developers build the future"}
                </p>
              </div>

              <form onSubmit={handleSubmit} className="space-y-6">
                <div>
                  <label className="block text-white font-bold mb-3 text-lg">
                    Username
                  </label>
                  <input
                    ref={usernameRef}
                    type="text"
                    required
                    className="w-full px-6 py-4 bg-white bg-opacity-10 border-2 border-white border-opacity-20 rounded-2xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-30 focus:border-purple-400 transition-all"
                    placeholder="Enter your username"
                  />
                </div>
                <div>
                  <label className="block text-white font-bold mb-3 text-lg">
                    Password
                  </label>
                  <input
                    ref={passwordRef}
                    type="password"
                    required
                    className="w-full px-6 py-4 bg-white bg-opacity-10 border-2 border-white border-opacity-20 rounded-2xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-30 focus:border-purple-400 transition-all"
                    placeholder="Enter your password"
                  />
                </div>
                <button
                  type="submit"
                  disabled={loading}
                  className="w-full btn-bold text-white font-bold py-4 px-8 rounded-2xl text-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {loading ? (
                    <span className="flex items-center justify-center">
                      <i className="fas fa-spinner fa-spin mr-2"></i>
                      Processing...
                    </span>
                  ) : isLogin ? (
                    "Sign In & Create"
                  ) : (
                    "Join CodeConnect"
                  )}
                </button>
                <div className="text-center pt-4">
                  <p className="text-white text-opacity-80 font-medium">
                    {isLogin
                      ? "New to CodeConnect?"
                      : "Already part of the community?"}
                    <button
                      type="button"
                      onClick={toggleMode}
                      className="text-accent font-bold hover:underline ml-2 text-lg"
                    >
                      {isLogin ? "Create Account" : "Sign In"}
                    </button>
                  </p>
                </div>
              </form>
            </div>
          </div>
        );
      }

      function Dashboard({
        user,
        projects,
        onRefresh,
        onViewProject,
        onDeleteProject,
        onCreateProject,
      }) {
        const [refreshing, setRefreshing] = useState(false);

        const handleRefresh = async () => {
          setRefreshing(true);
          try {
            await onRefresh();
            setTimeout(() => setRefreshing(false), 500);
          } catch (error) {
            setRefreshing(false);
          }
        };

        return (
          <div className="space-y-10">
            <div className="glass-card rounded-3xl p-10">
              <div className="flex items-center justify-between mb-8">
                <div>
                  <h1 className="text-5xl font-black text-gradient mb-4">
                    Welcome,{" "}
                    <span className="text-accent">{user.username}</span>! ï¿½
                  </h1>
                  <p className="text-white text-opacity-90 text-xl font-medium">
                    Build. Share. Collaborate. Dominate.
                  </p>
                </div>
                <div className="flex space-x-4">
                  <button
                    onClick={onCreateProject}
                    className="btn-bold text-white px-8 py-4 rounded-2xl font-bold text-lg"
                  >
                    <i className="fas fa-plus mr-3"></i>Create Project
                  </button>
                  <button
                    onClick={handleRefresh}
                    disabled={refreshing}
                    className="btn-outline text-white px-8 py-4 rounded-2xl font-bold text-lg disabled:opacity-50"
                  >
                    <i
                      className={`fas ${
                        refreshing ? "fa-spinner fa-spin" : "fa-sync-alt"
                      } mr-3`}
                    ></i>
                    {refreshing ? "Refreshing..." : "Refresh"}
                  </button>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div className="glass-card rounded-2xl p-8 text-center glow-effect">
                  <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-cyan-400 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <i className="fas fa-folder text-2xl text-white"></i>
                  </div>
                  <h3 className="text-4xl font-black text-white mb-2">
                    {projects.length}
                  </h3>
                  <p className="text-white text-opacity-70 font-bold text-lg">
                    Your Projects
                  </p>
                </div>
                <div className="glass-card rounded-2xl p-8 text-center glow-effect">
                  <div className="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-400 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <i className="fas fa-file-code text-2xl text-white"></i>
                  </div>
                  <h3 className="text-4xl font-black text-white mb-2">
                    {projects.reduce(
                      (total, project) => total + (project.files?.length || 0),
                      0
                    )}
                  </h3>
                  <p className="text-white text-opacity-70 font-bold text-lg">
                    Total Files
                  </p>
                </div>
                <div className="glass-card rounded-2xl p-8 text-center glow-effect">
                  <div className="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-400 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <i className="fas fa-clock text-2xl text-white"></i>
                  </div>
                  <h3 className="text-4xl font-black text-white mb-2">
                    {
                      projects.filter(
                        (p) =>
                          new Date(p.createdAt) >
                          new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
                      ).length
                    }
                  </h3>
                  <p className="text-white text-opacity-70 font-bold text-lg">
                    This Week
                  </p>
                </div>
              </div>
            </div>

            <div className="glass-card rounded-3xl p-10">
              <h2 className="text-3xl font-black text-gradient mb-8">
                Your Projects
              </h2>
              {projects.length === 0 ? (
                <div className="text-center py-16">
                  <i className="fas fa-folder-open text-8xl text-white text-opacity-30 mb-6"></i>
                  <h3 className="text-3xl font-black text-white text-opacity-70 mb-4">
                    No projects yet
                  </h3>
                  <p className="text-white text-opacity-60 mb-8 text-xl font-medium">
                    Ready to build something amazing?
                  </p>
                  <button
                    onClick={onCreateProject}
                    className="btn-bold text-white px-10 py-5 rounded-2xl font-bold text-xl"
                  >
                    <i className="fas fa-plus mr-3"></i>Create Your First
                    Project
                  </button>
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  {projects.map((project) => (
                    <div
                      key={project._id}
                      className="glass-card rounded-2xl p-6 hover:scale-105 transition-all duration-300"
                    >
                      <div className="mb-6">
                        <h3 className="text-2xl font-black text-white mb-3">
                          {project.title}
                        </h3>
                        <p className="text-white text-opacity-70 mb-4 font-medium">
                          {project.description || "No description"}
                        </p>

                        {project.technologies &&
                          project.technologies.length > 0 && (
                            <div className="mb-4">
                              <div className="flex flex-wrap gap-2">
                                {project.technologies
                                  .slice(0, 3)
                                  .map((tech, index) => (
                                    <span
                                      key={index}
                                      className="tech-badge text-white px-3 py-1 rounded-full text-sm font-bold"
                                    >
                                      {tech}
                                    </span>
                                  ))}
                                {project.technologies.length > 3 && (
                                  <span className="tech-badge text-white px-3 py-1 rounded-full text-sm font-bold">
                                    +{project.technologies.length - 3} more
                                  </span>
                                )}
                              </div>
                            </div>
                          )}

                        <div className="flex items-center text-white text-opacity-60 text-sm space-x-4 font-medium">
                          <span>
                            <i className="fas fa-calendar mr-2"></i>
                            {new Date(project.createdAt).toLocaleDateString()}
                          </span>
                          <span>
                            <i className="fas fa-file mr-2"></i>
                            {project.files?.length || 0} files
                          </span>
                        </div>
                      </div>
                      <div className="flex space-x-3">
                        <button
                          onClick={() => onViewProject(project)}
                          className="btn-bold text-white px-6 py-3 rounded-xl font-bold flex-1"
                        >
                          <i className="fas fa-eye mr-2"></i>View Files
                        </button>
                        <button
                          onClick={() => onDeleteProject(project._id)}
                          className="bg-gradient-to-r from-red-500 to-pink-500 text-white px-4 py-3 rounded-xl font-bold hover:from-red-600 hover:to-pink-600 transition-all"
                        >
                          <i className="fas fa-trash"></i>
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      }

      function CreateProject({ onProjectCreated, onBack }) {
        const [loading, setLoading] = useState(false);
        const [selectedFiles, setSelectedFiles] = useState([]);
        const [techStack, setTechStack] = useState([]);
        const [currentTech, setCurrentTech] = useState("");
        const titleRef = useRef();
        const descriptionRef = useRef();
        const fileInputRef = useRef();

        const handleSubmit = async (e) => {
          e.preventDefault();
          setLoading(true);

          const title = titleRef.current.value;
          const description = descriptionRef.current.value;

          if (!title.trim()) {
            alert("Please enter a project title");
            setLoading(false);
            return;
          }

          if (selectedFiles.length === 0) {
            alert("Please select at least one file");
            setLoading(false);
            return;
          }

          try {
            const formData = new FormData();
            formData.append("title", title);
            formData.append("description", description);
            formData.append("technologies", JSON.stringify(techStack));
            selectedFiles.forEach((file) => {
              formData.append("files", file);
            });

            const response = await api.uploadProject(formData);

            if (response.success) {
              alert("Project uploaded successfully!");
              titleRef.current.value = "";
              descriptionRef.current.value = "";
              setSelectedFiles([]);
              setTechStack([]);
              setCurrentTech("");
              if (fileInputRef.current) fileInputRef.current.value = "";
              onProjectCreated();
            } else {
              alert(response.message || "Failed to upload project");
            }
          } catch (error) {
            alert("Failed to upload project");
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="max-w-5xl mx-auto space-y-10">
            <div className="glass-card rounded-3xl p-10">
              <div className="flex items-center justify-between mb-10">
                <div>
                  <h1 className="text-5xl font-black text-gradient mb-4">
                    Create New Project
                  </h1>
                  <p className="text-white text-opacity-90 text-xl font-medium">
                    Share your masterpiece with the world
                  </p>
                </div>
                <button
                  onClick={onBack}
                  className="btn-outline text-white px-6 py-3 rounded-xl font-bold"
                >
                  <i className="fas fa-arrow-left mr-2"></i>Back
                </button>
              </div>

              <form onSubmit={handleSubmit} className="space-y-10">
                <div>
                  <label className="block text-white font-bold mb-4 text-xl">
                    Project Title *
                  </label>
                  <input
                    ref={titleRef}
                    type="text"
                    placeholder="Enter an awesome project title..."
                    className="w-full px-6 py-4 bg-white bg-opacity-10 border-2 border-white border-opacity-20 rounded-2xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-30 focus:border-purple-400 transition-all"
                  />
                </div>

                <div>
                  <label className="block text-white font-bold mb-4 text-xl">
                    Description
                  </label>
                  <textarea
                    ref={descriptionRef}
                    rows={5}
                    placeholder="Tell the world about your amazing project..."
                    className="w-full px-6 py-4 bg-white bg-opacity-10 border-2 border-white border-opacity-20 rounded-2xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-30 focus:border-purple-400 transition-all resize-none"
                  />
                </div>

                <div>
                  <label className="block text-white font-bold mb-4 text-xl">
                    Tech Stack
                  </label>
                  <div className="flex space-x-3 mb-4">
                    <input
                      type="text"
                      value={currentTech}
                      onChange={(e) => setCurrentTech(e.target.value)}
                      onKeyPress={(e) => {
                        if (e.key === "Enter") {
                          e.preventDefault();
                          if (
                            currentTech.trim() &&
                            !techStack.includes(currentTech.trim())
                          ) {
                            setTechStack([...techStack, currentTech.trim()]);
                            setCurrentTech("");
                          }
                        }
                      }}
                      placeholder="Add technology (e.g., React, Node.js, MongoDB)..."
                      className="flex-1 px-6 py-4 bg-white bg-opacity-10 border-2 border-white border-opacity-20 rounded-2xl text-white text-lg placeholder-white placeholder-opacity-60 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-30 focus:border-purple-400 transition-all"
                    />
                    <button
                      type="button"
                      onClick={() => {
                        if (
                          currentTech.trim() &&
                          !techStack.includes(currentTech.trim())
                        ) {
                          setTechStack([...techStack, currentTech.trim()]);
                          setCurrentTech("");
                        }
                      }}
                      className="btn-bold text-white px-6 py-4 rounded-2xl font-bold"
                    >
                      <i className="fas fa-plus text-lg"></i>
                    </button>
                  </div>

                  {techStack.length > 0 && (
                    <div className="flex flex-wrap gap-3 mb-4">
                      {techStack.map((tech, index) => (
                        <span
                          key={index}
                          className="tech-badge text-white px-4 py-2 rounded-full font-bold flex items-center space-x-2"
                        >
                          <span>{tech}</span>
                          <button
                            type="button"
                            onClick={() =>
                              setTechStack(
                                techStack.filter((_, i) => i !== index)
                              )
                            }
                            className="text-white hover:text-red-300 transition-colors"
                          >
                            <i className="fas fa-times"></i>
                          </button>
                        </span>
                      ))}
                    </div>
                  )}
                  <p className="text-white text-opacity-60 font-medium">
                    Press Enter or click + to add technologies
                  </p>
                </div>

                <div>
                  <h2 className="text-2xl font-bold text-white mb-6">
                    Upload Files *
                  </h2>
                  <div className="border-2 border-dashed border-purple-400 border-opacity-50 p-10 text-center rounded-3xl bg-purple-500 bg-opacity-5 hover:bg-opacity-10 transition-all">
                    <i className="fas fa-cloud-upload-alt text-6xl text-purple-400 mb-6"></i>
                    <p className="text-2xl font-bold text-white mb-3">
                      Drag & drop files here
                    </p>
                    <p className="text-white text-opacity-70 mb-6 text-lg">
                      or click to browse your computer
                    </p>
                    <input
                      ref={fileInputRef}
                      type="file"
                      multiple
                      onChange={(e) =>
                        setSelectedFiles(Array.from(e.target.files))
                      }
                      className="hidden"
                    />
                    <button
                      type="button"
                      onClick={() => fileInputRef.current?.click()}
                      className="btn-bold text-white px-8 py-4 rounded-2xl font-bold text-lg"
                    >
                      Browse Files
                    </button>
                  </div>
                </div>

                {selectedFiles.length > 0 && (
                  <div>
                    <h3 className="text-2xl font-bold text-white mb-6">
                      Selected Files ({selectedFiles.length})
                    </h3>
                    <div className="space-y-4">
                      {selectedFiles.map((file, index) => (
                        <div
                          key={index}
                          className="flex items-center justify-between p-6 glass-card rounded-2xl"
                        >
                          <div className="flex items-center space-x-4">
                            <span className="text-3xl">ðŸ“„</span>
                            <div>
                              <p className="font-bold text-white text-lg">
                                {file.name}
                              </p>
                              <p className="text-white text-opacity-60 font-medium">
                                {(file.size / 1024).toFixed(1)} KB
                              </p>
                            </div>
                          </div>
                          <button
                            type="button"
                            onClick={() =>
                              setSelectedFiles((prev) =>
                                prev.filter((_, i) => i !== index)
                              )
                            }
                            className="text-red-400 hover:text-red-300 text-xl"
                          >
                            <i className="fas fa-times"></i>
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div className="flex justify-end pt-6">
                  <button
                    type="submit"
                    disabled={loading}
                    className="btn-bold text-white px-12 py-5 rounded-2xl font-bold text-xl disabled:opacity-50"
                  >
                    {loading ? (
                      <span className="flex items-center">
                        <i className="fas fa-spinner fa-spin mr-3"></i>
                        Creating Magic...
                      </span>
                    ) : (
                      <span className="flex items-center">
                        <i className="fas fa-rocket mr-3"></i>
                        Launch Project
                      </span>
                    )}
                  </button>
                </div>
              </form>
            </div>
          </div>
        );
      }

      function FilesModal({ project, onClose, onDownload }) {
        if (!project) return null;

        return (
          <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
            <div className="glass-card rounded-3xl max-w-3xl w-full max-h-[85vh] overflow-hidden z-60">
              <div className="flex items-center justify-between p-8 border-b border-white border-opacity-20">
                <div>
                  <h3 className="text-3xl font-black text-white mb-2">
                    {project.title} - Files
                  </h3>
                  <p className="text-white text-opacity-70 font-bold text-lg">
                    {project.files?.length || 0} files
                  </p>
                  {project.technologies && project.technologies.length > 0 && (
                    <div className="flex flex-wrap gap-2 mt-4">
                      {project.technologies.map((tech, index) => (
                        <span
                          key={index}
                          className="tech-badge text-white px-3 py-1 rounded-full text-sm font-bold"
                        >
                          {tech}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
                <button
                  onClick={onClose}
                  className="text-white hover:text-red-400 text-3xl font-bold transition-colors"
                >
                  Ã—
                </button>
              </div>
              <div className="p-8 overflow-y-auto max-h-96">
                <div className="space-y-4">
                  {(project.files || []).map((file, index) => (
                    <div
                      key={index}
                      className="flex items-center justify-between p-6 glass-card rounded-2xl"
                    >
                      <div className="flex items-center space-x-4">
                        <span className="text-3xl">ðŸ“„</span>
                        <div>
                          <p className="font-bold text-white text-lg">
                            {file.originalName || file.filename}
                          </p>
                          <p className="text-white text-opacity-60 font-medium">
                            {((file.size || 0) / 1024).toFixed(1)} KB
                          </p>
                        </div>
                      </div>
                      <button
                        onClick={() => onDownload(project._id, file.filename)}
                        className="btn-bold text-white px-6 py-3 rounded-xl font-bold"
                      >
                        <i className="fas fa-download mr-2"></i>Download
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        );
      }

      function App() {
        const [user, setUser] = useState(null);
        const [isLogin, setIsLogin] = useState(true);
        const [currentView, setCurrentView] = useState("dashboard");
        const [projects, setProjects] = useState([]);
        const [selectedProject, setSelectedProject] = useState(null);
        const [showFilesModal, setShowFilesModal] = useState(false);
        const [loading, setLoading] = useState(true);

        useEffect(() => {
          const token = localStorage.getItem("token");
          const userData = localStorage.getItem("user");
          if (token && userData) {
            try {
              setUser(JSON.parse(userData));
            } catch (error) {
              localStorage.removeItem("token");
              localStorage.removeItem("user");
            }
          }
          setLoading(false);
        }, []);

        useEffect(() => {
          if (user && currentView === "dashboard") {
            fetchUserProjects();
          }
        }, [user, currentView]);

        const fetchUserProjects = async () => {
          if (!user) return;
          try {
            console.log("Fetching user projects...");
            const response = await api.getUserProjects();
            console.log("Projects response:", response);
            if (response.success) {
              setProjects(response.projects || []);
              console.log("Projects loaded:", response.projects?.length || 0);
            } else {
              console.error("Failed to fetch projects:", response.message);
            }
          } catch (error) {
            console.error("Error fetching projects:", error);
          }
        };

        const handleLogin = (userData) => {
          setUser(userData);
          setCurrentView("dashboard");
        };

        const handleLogout = () => {
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          setUser(null);
          setCurrentView("dashboard");
        };

        const handleViewProject = (project) => {
          setSelectedProject(project);
          setShowFilesModal(true);
        };

        const handleDeleteProject = async (projectId) => {
          if (window.confirm("Delete this project?")) {
            try {
              const response = await api.deleteProject(projectId);
              console.log("Delete response:", response);
              if (response.success) {
                alert("Project deleted successfully!");
                fetchUserProjects();
              } else {
                alert(response.message || "Failed to delete project");
              }
            } catch (error) {
              console.error("Delete error:", error);
              alert(
                "Network error: Please check your connection and try again"
              );
            }
          }
        };

        const handleDownloadFile = async (projectId, filename) => {
          try {
            await api.downloadFile(projectId, filename);
          } catch (error) {
            alert("Failed to download file");
          }
        };

        const handleProjectCreated = () => {
          setCurrentView("dashboard");
          fetchUserProjects();
        };

        if (loading) {
          return (
            <div className="min-h-screen flex items-center justify-center">
              <div className="text-center">
                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
                <p className="text-white text-lg">Loading...</p>
              </div>
            </div>
          );
        }

        if (!user) {
          return (
            <LoginForm
              onLogin={handleLogin}
              isLogin={isLogin}
              toggleMode={() => setIsLogin(!isLogin)}
            />
          );
        }

        return (
          <div className="min-h-screen relative z-10">
            <header className="glass-nav border-b border-white border-opacity-20 sticky top-0 z-50">
              <div className="container mx-auto px-4 py-6">
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    <div className="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center glow-effect">
                      <i className="fas fa-code text-white text-xl"></i>
                    </div>
                    <div>
                      <h1 className="text-3xl font-black text-gradient">
                        CodeConnect
                      </h1>
                      <p className="text-white text-opacity-70 font-bold">
                        Developer Platform
                      </p>
                    </div>
                  </div>

                  <nav className="hidden md:flex items-center space-x-8">
                    <button
                      onClick={() => setCurrentView("dashboard")}
                      className={`text-white px-6 py-3 rounded-2xl font-bold text-lg transition-all ${
                        currentView === "dashboard"
                          ? "bg-purple-500 bg-opacity-30"
                          : "hover:bg-white hover:bg-opacity-10"
                      }`}
                    >
                      <i className="fas fa-home mr-2"></i>Dashboard
                    </button>
                    <button
                      onClick={() => setCurrentView("create-project")}
                      className={`text-white px-6 py-3 rounded-2xl font-bold text-lg transition-all ${
                        currentView === "create-project"
                          ? "bg-purple-500 bg-opacity-30"
                          : "hover:bg-white hover:bg-opacity-10"
                      }`}
                    >
                      <i className="fas fa-plus mr-2"></i>Create
                    </button>
                  </nav>

                  <div className="flex items-center space-x-6">
                    <div className="text-right hidden sm:block">
                      <p className="text-white font-black text-lg">
                        {user.username}
                      </p>
                      <p className="text-accent font-bold">Developer</p>
                    </div>
                    <button
                      onClick={handleLogout}
                      className="btn-outline text-white px-6 py-3 rounded-2xl font-bold"
                    >
                      <i className="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                  </div>
                </div>
              </div>
            </header>

            <main className="container mx-auto px-4 py-10 pb-20 relative z-10">
              {currentView === "dashboard" && (
                <Dashboard
                  user={user}
                  projects={projects}
                  onRefresh={fetchUserProjects}
                  onViewProject={handleViewProject}
                  onDeleteProject={handleDeleteProject}
                  onCreateProject={() => setCurrentView("create-project")}
                />
              )}

              {currentView === "create-project" && (
                <CreateProject
                  onProjectCreated={handleProjectCreated}
                  onBack={() => setCurrentView("dashboard")}
                />
              )}
            </main>

            {showFilesModal && (
              <FilesModal
                project={selectedProject}
                onClose={() => setShowFilesModal(false)}
                onDownload={handleDownloadFile}
              />
            )}
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
